var FlyingObject=function(){function e(){}var t=(__define,e),i=t.prototype;return i.move=function(){this.model.y+=this.speed},i.hit=function(){this.hp--},i.isDestroyed=function(){var e=this.model.height/2+this.model.y<0?!0:!1,t=this.hp<=0?!0:!1;return e||t},e}();egret.registerClass(FlyingObject,"FlyingObject");var Bullet=function(e){function t(t,i){e.call(this),this.createBullet(t,i)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createBullet=function(e,t){var i;return this.speed=-10,this.hp=1,this.model=new egret.Bitmap(RES.getRes("bullet")),this.model.width=6,this.model.height=14,this.model.anchorOffsetX=this.model.width/2,this.model.anchorOffsetY=this.model.height/2,this.model.x=e,this.model.y=t,i},t}(FlyingObject);egret.registerClass(Bullet,"Bullet");var enemyType;!function(e){e[e.small=0]="small",e[e.normal=1]="normal",e[e.big=2]="big"}(enemyType||(enemyType={}));var Enemy=function(e){function t(t){e.call(this),this.createEnemy(t)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createEnemy=function(e){var t,i,s,o,n,h;switch(e){case enemyType.big:n=12,o=3,i=110,s=164,h="enemy3";break;case enemyType.normal:n=6,o=5,i=46,s=60,h="enemy2";break;default:n=1,o=8,i=34,s=24,h="enemy1"}return this.type=e,this.speed=o,this.hp=n,this.model=new egret.Bitmap(RES.getRes(h)),this.model.width=i,this.model.height=s,this.model.anchorOffsetX=this.model.width/2,this.model.anchorOffsetY=this.model.height/2,this.model.y=-s,this.model.x=Math.random()*(320-i)+i/2,t},s.destroy=function(){var e,t=[];switch(this.type){case enemyType.big:e="enemy3_down";break;case enemyType.normal:e="enemy2_down";break;default:e="enemy1_down"}for(var i=1;4>=i;i++){var s=new egret.Bitmap(RES.getRes(e+i));s=new egret.Bitmap(RES.getRes(e+i)),s.width=this.model.width,s.height=this.model.height,s.anchorOffsetX=this.model.width/2,s.anchorOffsetY=this.model.height/2,s.x=this.model.x,s.y=this.model.y,t.push(s)}return t},s.isDestroyed=function(){var e=this.model.y-this.model.height/2>568?!0:!1,t=this.hp<=0?!0:!1;return e||t},t}(FlyingObject);egret.registerClass(Enemy,"Enemy");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=200,this.textField.width=320,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.enemies=[],this.enemyDestroyAnimation=[],this.bullets=[],this.score=0,this.timeTick=0,this.touchStatus=!1,this.touchPosition=new egret.Point,this.touchPositionLimits={left:33,right:287,top:40,bottom:528},this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("flight")},s.onResourceLoadComplete=function(e){"flight"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"flight"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.createGameScene=function(){var e=new egret.Bitmap(RES.getRes("start-background"));e.x=0,e.y=0,this.addChild(e);var t=this.drawStartButton();t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},s.drawStartButton=function(){var e=new egret.Shape;e.graphics.beginFill(0,0),e.graphics.lineStyle(1,2236962),e.graphics.drawRoundRect(110,420,100,40,10,10),e.graphics.endFill(),this.addChild(e);var t=new egret.TextField;return t.text="开始游戏",t.fontFamily="MicroSoft YaHei",t.size=16,t.bold=!1,t.textColor=0,t.width=320,t.textAlign="center",t.y=432,this.addChild(t),t},s.startGame=function(){this.score=0,this.background=new egret.Bitmap(RES.getRes("background")),this.player=new Player,this.player.model.touchEnabled=!0,this.player.model.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.player.model.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.touchPosition.x=this.player.model.x,this.touchPosition.y=this.player.model.y,this.timer=new egret.Timer(50,0),this.timer.start(),this.timer.addEventListener(egret.TimerEvent.TIMER,this.renderPlane,this)},s.renderPlane=function(e){this.removeChildren(),this.addChild(this.background);for(var t=0;t<this.enemyDestroyAnimation.length;t++)0!=this.enemyDestroyAnimation[t].length&&this.addChild(this.enemyDestroyAnimation[t][0]);for(var t=0;t<this.enemies.length;t++)this.addChild(this.enemies[t].model);for(var t=0;t<this.bullets.length;t++)this.addChild(this.bullets[t].model);this.addChild(this.player.model),this.updateData()},s.updateData=function(){this.timeTick+=1,this.timeTick=this.timeTick%21,this.addNewBullet(this.timeTick),this.addNewEnemy(this.timeTick),this.hitTest();for(var e=0;e<this.enemyDestroyAnimation.length;e++)0!=this.enemyDestroyAnimation[e].length?this.enemyDestroyAnimation[e].splice(0,1):(this.enemyDestroyAnimation.splice(e,1),e--);for(var t=[],e=0;e<this.enemies.length;e++)this.enemies[e].move(),this.enemies[e].isDestroyed()?this.enemyDestroyAnimation.push(this.enemies[e].destroy()):t.push(this.enemies[e]);this.enemies=t;for(var i=[],e=0;e<this.bullets.length;e++)this.bullets[e].move(),this.bullets[e].isDestroyed()||i.push(this.bullets[e]);this.bullets=i},s.addNewEnemy=function(e){var t,i=Math.floor(2*Math.random()*e);switch(i){case 10:t=new Enemy(enemyType.small),this.enemies.push(t);break;case 20:t=new Enemy(enemyType.normal),this.enemies.push(t);break;case 30:t=new Enemy(enemyType.big),this.enemies.push(t)}},s.addNewBullet=function(e){if(0==e||7==e||14==e){var t=new Bullet(this.player.model.x-22,this.player.model.y-18),i=new Bullet(this.player.model.x+22,this.player.model.y-18);this.bullets.push(t),this.bullets.push(i)}},s.hitTest=function(){for(var e=0;e<this.enemies.length;e++){for(var t=0;t<this.bullets.length;t++){var i={};if(i.x=this.bullets[t].model.x,i.y=this.bullets[t].model.y-this.bullets[t].model.height/2,i.y>0){var s=this.enemies[e].model.hitTestPoint(i.x,i.y);s&&(this.enemies[e].hit(),this.bullets[t].hit(),this.score++)}}var o=[],n=this.player.model.x,h=this.player.model.y,r=this.player.model.width,a=this.player.model.height;o[0]={x:n,y:h+1*a/4},o[1]={x:n+r/2,y:h+3*a/8},o[2]={x:n-r/2,y:h+3*a/8},o[3]={x:n-r/3,y:h+a/2},o[4]={x:n+r/3,y:h+a/2},o[5]={x:n,y:h-a/2};for(var l=0;6>l;l++){var d=this.enemies[e].model.hitTestPoint(o[l].x,o[l].y);if(d){this.endGame();break}}}},s.endGame=function(){this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.renderPlane,this),this.player.model.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.player.model.removeEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this),this.enemies=[],this.bullets=[],this.enemyDestroyAnimation=[],this.timeTick=0,this.touchStatus=!1,this.player=null,this.drawScoreboard()},s.drawScoreboard=function(){var e=new egret.Shape;e.graphics.beginFill(13421772,1),e.graphics.lineStyle(1,2236962,1),e.graphics.drawRoundRect(60,200,200,168,10,10),e.graphics.moveTo(60,240),e.graphics.lineTo(260,240),e.graphics.endFill(),this.addChild(e);var t=new egret.TextField;t.text="飞机大战分数",t.fontFamily="MicroSoft YaHei",t.size=16,t.bold=!1,t.textColor=0,t.width=320,t.textAlign="center",t.y=215,this.addChild(t);var i=new egret.TextField;i.text=this.score.toString(),i.fontFamily="MicroSoft YaHei",i.size=18,i.bold=!1,i.textColor=0,i.width=320,i.textAlign="center",i.y=265,this.addChild(i);var s=new egret.Shape;s.graphics.beginFill(0,0),s.graphics.lineStyle(1,2236962),s.graphics.drawRoundRect(110,300,100,40,10,10),s.graphics.endFill(),this.addChild(s);var o=new egret.TextField;o.text="重新开始",o.fontFamily="MicroSoft YaHei",o.size=16,o.bold=!1,o.textColor=0,o.width=320,o.textAlign="center",o.y=313,this.addChild(o),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},s.mouseDown=function(e){this.touchStatus=!0,this.touchPosition.x=e.stageX-this.player.model.x,this.touchPosition.y=e.stageY-this.player.model.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},s.mouseMove=function(e){if(this.touchStatus){var t=e.stageX-this.touchPosition.x,i=e.stageY-this.touchPosition.y;t=t<this.touchPositionLimits.left?this.touchPositionLimits.left:t,i=i<this.touchPositionLimits.top?this.touchPositionLimits.top:i,t=t>this.touchPositionLimits.right?this.touchPositionLimits.right:t,i=i>this.touchPositionLimits.bottom?this.touchPositionLimits.bottom:i,this.player.model.x=t,this.player.model.y=i}},s.mouseUp=function(e){this.touchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Player=function(e){function t(){e.call(this),this.createPlayer()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createPlayer=function(){var e;return this.speed=0,this.hp=1,this.model=new egret.Bitmap(RES.getRes("player")),this.model.width=66,this.model.height=80,this.model.anchorOffsetX=this.model.width/2,this.model.anchorOffsetY=this.model.height/2,this.model.x=160,this.model.y=568-this.model.height/2,e},t}(FlyingObject);egret.registerClass(Player,"Player");